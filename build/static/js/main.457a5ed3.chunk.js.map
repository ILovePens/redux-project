{"version":3,"sources":["features/tictactoe/Tictactoe.module.css","features/counter/Counter.module.css","features/bejeweled/Counter.module.css","history.js","localStorage.js","components/Connexion.js","features/nav/navSlice.js","features/general/helpers/Components.js","features/nav/Nav.js","features/counter/counterAPI.js","features/counter/counterSlice.js","features/counter/Counter.js","features/tictactoe/tictactoeSlice.js","features/tictactoe/components/Square.js","features/tictactoe/components/Board.js","features/tictactoe/TicTacToe.js","base.js","features/connectX/connectXAPI.js","features/connectX/connectXSlice.js","features/connectX/components/Slot.js","features/connectX/ConnectXTransitions.js","features/connectX/components/Board.js","features/connectX/components/Form.js","features/connectX/ConnectX.js","features/general/helpers/Functions.js","features/bejeweled/counterAPI.js","features/bejeweled/counterSlice.js","features/bejeweled/Tbd.js","App.js","components/NotFound.js","app/store.js","index.js","features/connectX/ConnectX.module.css"],"names":["module","exports","createBrowserHistory","loadState","serializedState","localStorage","getItem","JSON","parse","err","saveState","state","stringify","setItem","console","log","Connexion","goToApp","event","preventDefault","pseudo","pseudoInput","value","history","push","className","onSubmit","i","type","placeholder","required","ref","input","React","Component","navSlice","createSlice","name","initialState","reducers","reset","actions","Switch","props","checked","isOn","onClick","readOnly","Reset","title","Nav","dispatch","useDispatch","navItems","Object","keys","items","map","key","index","handleClick","fetchCount","amount","Promise","resolve","setTimeout","data","incrementAsync","createAsyncThunk","a","response","counterSlice","status","increment","decrement","incrementByAmount","action","payload","extraReducers","builder","addCase","pending","fulfilled","selectCount","counter","Counter","count","useSelector","useState","incrementAmount","setIncrementAmount","incrementValue","Number","styles","row","button","textbox","onChange","e","target","asyncButton","getState","squares","Array","fill","winSquares","xIsNext","stepNumber","sortIsAsc","tictactoeSlice","slice","length","concat","jumpTo","toggleSort","selectHistory","tictactoe","selectStepNumber","selectXIsNext","selectSortIsAsc","Square","squareWinClass","find","win","square","Board","this","board","j","renderSquare","board_row","isGameBoard","isSelected","gameBoardClass","game_board","selectedClass","selected","createBoard","TicTacToe","current","lines","b","c","calculateWinner","moves","step","move","desc","sort","game","game_info","scrollableY","app","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","getFirestore","readPlayers","db","getDatabase","get","then","players","exists","val","catch","error","compareGameState","turnData","readTurnAction","readStepNumber","turnAction","dataSnapshot","readGamePlayers","snapshot","gameIsOn","slots","boardFlip","number","gameSettings","width","height","scoreTarget","currentSign","gravIsOn","transitions","initPlayersAsync","arg","thunkAPI","removePlayers","requestGame","updateStateAsync","requestGameAsync","playerCount","set","connectXSlice","fillSlot","slotIndex","slotValue","startOfTurn","isEndTurn","gravIsOff","baseRef","toggleGravity","singleSlotMode","isAction","toggle","slotScore","l","targetIndex","hasTransitions","filter","el","flipBoardState","flipValue","newSlots","rowCount","endTurn","changeStep","setGameSettings","settings","isDbReset","window","alert","playersRefs","sign","connectX","selectGameSettings","selectGravityState","selectTransitions","selectCurrentSign","selectPlayers","selectTurnAction","flipBoard","direction","watchTimer","setInterval","clearInterval","Slot","transitionClass","speed","fall","Math","round","contentClass","slotContent","slotContentX","slotContentO","winClass","winStyle","slot","style","onTransitionEnd","handleTransitionEnd","styleWin","from","document","querySelectorAll","forEach","classList","add","winIndexes","renderSlot","isBoardWon","transition","animationCallback","onClickFunc","undefined","includes","maxScore","findIndex","boardParams","isMainBoard","slotTransitions","slotTransition","startAngle","flip","main_board","styleBoard","size","slotSize","floor","innerHeight","slotSizeDiff","fontSize","remove","animate","main","Form","prepareInfos","parseInt","minVal","gameInfos","sendGameSettings","infosForm","form","pattern","maxLength","ConnectX","currentSlots","gameSettingsForm","requestGameButton","endTurnButton","resetButton","gameControls","disabledGameControls","disabled","playSlotFunc","myPlayer","isPlayer","waitingForGame","inGame","onunload","mySign","isMyTurn","watchGame","boardWidth","previous","rowLength","winSlots","finalWinSlots","indexes","currentValue","streakL","streakR","streakT","streakB","streakTL","streakBR","streakTR","streakBL","isLatestHistoryMove","streakCount","controls","Tbd","App","itemSelected","userPseudo","bind","setState","vh","documentElement","setProperty","createElement","NotFound","combinedReducer","combineReducers","nav","navReducer","counterReducer","tictactoeReducer","connectXReducer","customizedMiddleware","getDefaultMiddleware","serializableCheck","configureStore","reducer","middleware","baseURL","ReactDOM","render","StrictMode","store","exact","path","component","getElementById"],"mappings":"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","file":"static/js/main.457a5ed3.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"board_row\":\"Tictactoe_board_row__3rgFx\",\"status\":\"Tictactoe_status__1yWkH\",\"square\":\"Tictactoe_square__2FLKp\",\"selected\":\"Tictactoe_selected__2J0dk\",\"win\":\"Tictactoe_win__3iu36\",\"kbd-navigation\":\"Tictactoe_kbd-navigation__1k7WA\",\"game\":\"Tictactoe_game__1L0bM\",\"game_info\":\"Tictactoe_game_info__3MppA\",\"board\":\"Tictactoe_board__EHRYs\",\"game_board\":\"Tictactoe_game_board__10zJy\",\"moves\":\"Tictactoe_moves__1SQaE\",\"scrollableY\":\"Tictactoe_scrollableY__Q9GYP\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"row\":\"Counter_row__25RA2\",\"value\":\"Counter_value__1LyDH\",\"button\":\"Counter_button__1Mrat\",\"textbox\":\"Counter_textbox__3xGUA\",\"asyncButton\":\"Counter_asyncButton__24jSS Counter_button__1Mrat\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"row\":\"Counter_row__-ob4V\",\"value\":\"Counter_value__1mJ_F\",\"button\":\"Counter_button__2N3Ru\",\"textbox\":\"Counter_textbox__3t7Hj\",\"asyncButton\":\"Counter_asyncButton__3xT0m Counter_button__2N3Ru\"};","import { createBrowserHistory } from 'history';\r\n\r\nexport default createBrowserHistory();","\r\nexport const loadState = () => {\r\n\ttry{\r\n\t\tconst serializedState = localStorage.getItem('state');\r\n\t\tif(serializedState === null){\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\treturn JSON.parse(serializedState)\r\n\t} catch (err) {\r\n\t\treturn undefined;\r\n\t}\r\n}\r\n\r\nexport const saveState = (state) => {\r\n\ttry{\r\n\t\tconst serializedState = JSON.stringify(state)\r\n\t\tlocalStorage.setItem('state', serializedState);\r\n\t} catch (err) {\r\n\t\tconsole.log(err)\r\n\t}\r\n}","import React from 'react';\r\nimport { saveState } from '../localStorage';\r\nimport history from '../history';\r\nclass Connexion extends React.Component {\r\n\tgoToApp = event => {\r\n\t\tevent.preventDefault();\r\n\t\tconsole.log(this);\r\n\t\tconst pseudo = this.pseudoInput.value;\r\n\t\tsaveState(pseudo);\r\n\t\thistory.push(`/redux-project/`);\r\n\t};\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div className=\"connexionBox\" onSubmit={(i) => this.goToApp(i)}>\r\n\t\t\t\t<form className=\"connexion\" >\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\tplaceholder=\"Pseudo\"\r\n\t\t\t\t\t\trequired\r\n\t\t\t\t\t\tref={input => {this.pseudoInput = input}}/>\r\n\t\t\t\t\t<button type=\"submit\">GO</button>\r\n\t\t\t\t</form>\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default Connexion;","import { createSlice } from '@reduxjs/toolkit';\r\n\r\nconst initialState = {\r\n};\r\n\r\nexport const navSlice = createSlice({\r\n  name: 'nav',\r\n  initialState,\r\n  // The `reducers` field lets us define reducers and generate associated actions\r\n  reducers: {\r\n    reset: state => {\r\n      // From here we can take action only at this \"counter\" state\r\n      // But, as we have taken care of this particular \"logout\" action\r\n      // in rootReducer, we can use it to CLEAR the complete Redux Store's state\r\n    }\r\n  }\r\n});\r\n\r\nexport const { reset } = navSlice.actions;\r\n\r\n\r\nexport default navSlice.reducer;\r\n","import React from 'react';\r\n\r\nexport function Switch(props) {\r\n  return (\r\n    <label className=\"switch\">\r\n\t\t  <input\r\n\t\t\t  type=\"checkbox\"\r\n\t\t\t  checked={props.isOn}\r\n\t\t\t  onClick={props.onClick}\r\n\t\t\t  readOnly\r\n\t\t  />\r\n\t\t  <span className=\"slider\"></span>\r\n\t\t</label>\r\n\t);\r\n}\r\n\r\nexport function Reset(props) {\r\n  return (\r\n    <button className=\"reset\" onClick={props.onClick}>\r\n    \t{props.title}\t\t\t  \r\n\t</button>\r\n\t);\r\n}\r\n\r\n","import React from 'react';\r\nimport { useDispatch } from 'react-redux';\r\nimport { reset } from './navSlice';\r\nimport { Reset } from '../general/helpers/Components';\r\n// import styles from './Nav.module.css';\r\n\r\nexport function Nav(props) {\r\n  const dispatch = useDispatch();\r\n  const navItems = Object.keys(props.items)\r\n        .map((key,index) =>\r\n          <button name={key} key={index} onClick={(i) => props.handleClick(i)}>{key}</button>\r\n        );\r\n  return (\r\n    <header className=\"App-header\">\r\n      <div className=\"nav-items\">\r\n        {navItems}\r\n      </div>\r\n      <Reset title=\"Reset all\" onClick={() => dispatch(reset())}/>        \r\n    </header>\r\n  );\r\n}\r\n","// A mock function to mimic making an async request for data\r\nexport function fetchCount(amount = 1) {\r\n  return new Promise((resolve) =>\r\n    setTimeout(() => resolve({ data: amount }), 500)\r\n  );\r\n}\r\n","import { createAsyncThunk, createSlice } from '@reduxjs/toolkit';\r\nimport { fetchCount } from './counterAPI';\r\n\r\nconst initialState = {\r\n  value: 0,\r\n  status: 'idle',\r\n};\r\n\r\n// The function below is called a thunk and allows us to perform async logic. It\r\n// can be dispatched like a regular action: `dispatch(incrementAsync(10))`. This\r\n// will call the thunk with the `dispatch` function as the first argument. Async\r\n// code can then be executed and other actions can be dispatched. Thunks are\r\n// typically used to make async requests.\r\nexport const incrementAsync = createAsyncThunk(\r\n  'counter/fetchCount',\r\n  async (amount) => {\r\n    const response = await fetchCount(amount);\r\n    // The value we return becomes the `fulfilled` action payload\r\n    return response.data;\r\n  }\r\n);\r\n\r\nexport const counterSlice = createSlice({\r\n  name: 'counter',\r\n  initialState,\r\n  // The `reducers` field lets us define reducers and generate associated actions\r\n  reducers: {\r\n    increment: (state) => {\r\n      // Redux Toolkit allows us to write \"mutating\" logic in reducers. It\r\n      // doesn't actually mutate the state because it uses the Immer library,\r\n      // which detects changes to a \"draft state\" and produces a brand new\r\n      // immutable state based off those changes\r\n      state.value += 1;\r\n    },\r\n    decrement: (state) => {\r\n      state.value -= 1;\r\n    },\r\n    // Use the PayloadAction type to declare the contents of `action.payload`\r\n    incrementByAmount: (state, action) => {\r\n      state.value += action.payload;\r\n    },\r\n    reset: (state) => {\r\n      state.value = 0;\r\n    }\r\n  },\r\n  // The `extraReducers` field lets the slice handle actions defined elsewhere,\r\n  // including actions generated by createAsyncThunk or in other slices.\r\n  extraReducers: (builder) => {\r\n    builder\r\n      .addCase(incrementAsync.pending, (state) => {\r\n        state.status = 'loading';\r\n      })\r\n      .addCase(incrementAsync.fulfilled, (state, action) => {\r\n        state.status = 'idle';\r\n        state.value += action.payload;\r\n      });\r\n  },\r\n});\r\nexport const { increment, decrement, incrementByAmount, reset } = counterSlice.actions;\r\n\r\n// The function below is called a selector and allows us to select a value from\r\n// the state. Selectors can also be defined inline where they're used instead of\r\n// in the slice file. For example: `useSelector((state: RootState) => state.counter.value)`\r\nexport const selectCount = (state) => state.counter.value;\r\n\r\n// We can also write thunks by hand, which may contain both sync and async logic.\r\n// Here's an example of conditionally dispatching actions based on current state.\r\nexport const incrementIfOdd = (amount) => (dispatch, getState) => {\r\n  const currentValue = selectCount(getState());\r\n  if (currentValue % 2 === 1) {\r\n    dispatch(incrementByAmount(amount));\r\n  }\r\n};\r\n\r\nexport default counterSlice.reducer;\r\n","import React, { useState } from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport {\r\n  decrement,\r\n  increment,\r\n  incrementByAmount,\r\n  incrementAsync,\r\n  incrementIfOdd,\r\n  reset,\r\n  selectCount,\r\n} from './counterSlice';\r\nimport { Reset } from '../general/helpers/Components';\r\nimport styles from './Counter.module.css';\r\n\r\nexport function Counter() {\r\n  const count = useSelector(selectCount);\r\n  const dispatch = useDispatch();\r\n  const [incrementAmount, setIncrementAmount] = useState('2');\r\n\r\n  const incrementValue = Number(incrementAmount) || 0;\r\n\r\n  return (\r\n    <div>\r\n      <div className={styles.row}>\r\n        <button\r\n          className={styles.button}\r\n          aria-label=\"Decrement value\"\r\n          onClick={() => dispatch(decrement())}\r\n        >\r\n          -\r\n        </button>\r\n        <span className={styles.value}>{count}</span>\r\n        <button\r\n          className={styles.button}\r\n          aria-label=\"Increment value\"\r\n          onClick={() => dispatch(increment())}\r\n        >\r\n          +\r\n        </button>\r\n      </div>\r\n      <div className={styles.row}>\r\n        <input\r\n          className={styles.textbox}\r\n          aria-label=\"Set increment amount\"\r\n          value={incrementAmount}\r\n          onChange={(e) => setIncrementAmount(e.target.value)}\r\n        />\r\n        <button\r\n          className={styles.button}\r\n          onClick={() => dispatch(incrementByAmount(incrementValue))}\r\n        >\r\n          Add Amount\r\n        </button>\r\n        <button\r\n          className={styles.asyncButton}\r\n          onClick={() => dispatch(incrementAsync(incrementValue))}\r\n        >\r\n          Add Async\r\n        </button>\r\n        <button\r\n          className={styles.button}\r\n          onClick={() => dispatch(incrementIfOdd(incrementValue))}\r\n        >\r\n          Add If Odd\r\n        </button>\r\n        <Reset title=\"Reset\" onClick={() => dispatch(reset())}/>        \r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { createSlice } from '@reduxjs/toolkit';\r\n// import { fetchCount } from './tictactoeAPI';\r\n\r\nconst initialState = {\r\n  // Shared states\r\n  history: [{\r\n    squares: Array(9).fill(null),\r\n  }],\r\n  winSquares: [], \r\n\r\n  // Game only states\r\n  xIsNext: true,\r\n  stepNumber: 0,\r\n  sortIsAsc: true,\r\n};\r\n\r\nexport const tictactoeSlice = createSlice({\r\n  name: 'tictactoe',\r\n  initialState,\r\n  // The `reducers` field lets us define reducers and generate associated actions\r\n  reducers: {\r\n    handleClick: (state, action) => {\r\n      const history = state.history.slice(0, state.stepNumber + 1);\r\n      // We ensure the erasure of any \"future\" steps if the game is resumed from a history move\r\n      const current = history[history.length - 1];    \r\n      const squares = current.squares.slice();\r\n\r\n      if (state.winSquares.length || squares[action.payload] ) {\r\n        return; // Can't play a square if there's a winner or if it has already been played\r\n      }\r\n      // We alternate players, add the current board to the history, and assign the stepNumber based on the new history\r\n      squares[action.payload] = state.xIsNext ? 'X' : 'O';\r\n\r\n      state.history = history.concat([{squares: squares}]);\r\n      state.stepNumber = history.length;      \r\n      state.xIsNext = !state.xIsNext      \r\n    },\r\n\r\n    jumpTo: (state, action) => {\r\n      state.stepNumber = action.payload;\r\n      state.xIsNext = (action.payload % 2) === 0;\r\n    },\r\n\r\n    toggleSort: (state) => {\r\n      state.sortIsAsc = state.sortIsAsc ? false : true;\r\n    },\r\n\r\n    reset: (state) => {\r\n      state.history = [{squares: Array(9).fill(null)}];\r\n      state.stepNumber = 0;\r\n    }\r\n  },\r\n  // The `extraReducers` field lets the slice handle actions defined elsewhere,\r\n  // including actions generated by createAsyncThunk or in other slices.\r\n  // extraReducers: (builder) => {\r\n  //   builder\r\n  //     .addCase(incrementAsync.pending, (state) => {\r\n  //       state.status = 'loading';\r\n  //     })\r\n  //     .addCase(incrementAsync.fulfilled, (state, action) => {\r\n  //       state.status = 'idle';\r\n  //       state.value += action.payload;\r\n  //     });\r\n  // },\r\n});\r\n\r\nexport const { handleClick, jumpTo, toggleSort, reset } = tictactoeSlice.actions;\r\n\r\n// The function below is called a selector and allows us to select a value from\r\n// the state. Selectors can also be defined inline where they're used instead of\r\n// in the slice file. For example: `useSelector((state: RootState) => state.tictactoe.value)`\r\nexport const selectHistory = (state) => state.tictactoe.history;\r\nexport const selectStepNumber = (state) => state.tictactoe.stepNumber;\r\nexport const selectXIsNext = (state) => state.tictactoe.xIsNext;\r\nexport const selectSortIsAsc = (state) => state.tictactoe.sortIsAsc;\r\n\r\n// We can also write thunks by hand, which may contain both sync and async logic.\r\n// Here's an example of conditionally dispatching actions based on current state.\r\n// export const incrementIfOdd = (amount) => (dispatch, getState) => {\r\n//   const currentValue = selectCount(getState());\r\n//   if (currentValue % 2 === 1) {\r\n//     dispatch(incrementByAmount(amount));\r\n//   }\r\n// };\r\n\r\nexport default tictactoeSlice.reducer;\r\n","import React from 'react';\r\nimport styles from '../Tictactoe.module.css';\r\n\r\nfunction Square(props) {\r\n\tlet squareWinClass = \"\";\r\n\tif(props.winSquares) {\r\n\tsquareWinClass = (props.winSquares).find(e => e === props.index) + 1 ? \" \" + styles.win : \"\";\r\n\t\t// +1 is here to avoid a failed test when the square indexed \"0\" is part of the winning squares\r\n\t}\r\n  return (\r\n    <button\r\n    \tclassName={styles.square + squareWinClass}\r\n    \tonClick={props.onClick} //this is not html onClick\r\n    >\r\n      {props.value}\r\n    </button>\r\n  );\r\n}\r\n\r\nexport default Square;","import React from 'react';\r\nimport Square from './Square';\r\nimport styles from '../Tictactoe.module.css';\r\n\r\nclass Board extends React.Component {\r\n  renderSquare(i) {\r\n    return (\r\n    \t<Square\r\n    \t\tkey={i}   // We can't access \"key\" as a prop in child\r\n    \t\tindex={i} // component so we pass it here instead\r\n    \t\tvalue={this.props.squares[i]}\r\n    \t\tonClick={() => this.props.onClick(i)}\r\n    \t\twinSquares={this.props.winSquares}\r\n    \t/> \r\n    );\r\n  }\r\n\r\n  createBoard() {\r\n    let board = []\r\n    let index = -1;\r\n    // Outer loop to create parent\r\n    for (let i = 0; i < 3; i++) {\r\n      let squares = [];\r\n      //Inner loop to create children\r\n      for (let j = 0; j < 3; j++) {\r\n        index++;\r\n        squares.push(this.renderSquare(index));\r\n      }\r\n      //Create the parent and add the children\r\n      board.push(<div key={i} className={styles.board_row}>{squares}</div>)\r\n    }\r\n    return board\r\n  }\r\n\r\n  render() {\r\n    const isGameBoard = typeof this.props.isSelected === \"undefined\" ? true : false;\r\n\r\n    const gameBoardClass = isGameBoard ? \" \" + styles.game_board : \"\";\r\n    const selectedClass = this.props.isSelected ? \" \" + styles.selected : \"\";\r\n    const title = isGameBoard ? \"\" : this.props.title;\r\n    return (\r\n      <div>\r\n        <div className={styles.board + gameBoardClass + selectedClass} >\r\n          {this.createBoard()}\r\n        </div>\r\n        <p>{title}</p>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Board;","import React from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport {\r\n  handleClick,\r\n  jumpTo,\r\n  toggleSort,\r\n  reset,\r\n\r\n  selectHistory,\r\n  selectStepNumber,\r\n  selectSortIsAsc,\r\n  selectXIsNext\r\n} from './tictactoeSlice';\r\nimport Board from './components/Board';\r\nimport {Switch, Reset} from '../general/helpers/Components';\r\nimport styles from './Tictactoe.module.css';\r\n\r\nfunction calculateWinner(squares) {\r\n  const lines = [\r\n    [0, 1, 2],\r\n    [3, 4, 5],\r\n    [6, 7, 8],\r\n    [0, 3, 6],\r\n    [1, 4, 7],\r\n    [2, 5, 8],\r\n    [0, 4, 8],\r\n    [2, 4, 6],\r\n  ];\r\n  for (let i = 0; i < lines.length; i++) {\r\n    const [a, b, c] = lines[i];\r\n    if (squares[a] && squares[a] === squares[b] && squares[a] === squares[c]) {\r\n      return lines[i];\r\n    }\r\n  }\r\n  return [];\r\n}\r\n\r\nexport function TicTacToe() {\r\n  \r\n  const dispatch = useDispatch();\r\n\r\n  const history = useSelector(selectHistory);\r\n  const stepNumber = useSelector(selectStepNumber);\r\n  // const history = useSelector((state: RootState) => state.tictactoe.history);\r\n  // const stepNumber = useSelector((state: RootState) => state.tictactoe.stepNumber);\r\n\r\n  const current = history[stepNumber];\r\n  const winSquares = calculateWinner(current.squares);\r\n\r\n  // We create the move list to be displayed from the history\r\n  var moves = history.map((step, move) => {\r\n    const desc = move ?\r\n      'Move #' + move :\r\n      'Game start';\r\n    const isSelected = stepNumber === move ? true : false;\r\n    return (\r\n      <li key={move}>\r\n        <Board\r\n          isSelected={isSelected}\r\n          squares={history[move].squares}\r\n          onClick={() => dispatch(jumpTo(move))}\r\n          title={desc}\r\n        />\r\n      </li>\r\n    );\r\n  });\r\n\r\n\r\n  const sortIsAsc = useSelector(selectSortIsAsc);\r\n  // We sort the resulting array in descending order if the toggle is on\r\n  moves = sortIsAsc ? moves : moves.sort((a, b) => b.key - a.key);\r\n\r\n  // Choose which game status has to be displayed\r\n  const xIsNext = useSelector(selectXIsNext);\r\n  let status;\r\n  if (winSquares.length) {\r\n    status = 'Winner: ' + (xIsNext ? 'O' : 'X')\r\n  } else if (stepNumber === 9 && !winSquares.length) {\r\n    status = 'Draw!'\r\n  } else {\r\n    status = 'Next player: ' + (xIsNext ? 'X' : 'O')\r\n  }\r\n\r\n  return (\r\n    <div className={styles.game}>\r\n      <Board \r\n        squares={current.squares}\r\n        winSquares={winSquares}\r\n        onClick={(i) => dispatch(handleClick(i))}\r\n      />\r\n      <div className={styles.game_info}>\r\n        <div>{status}</div>\r\n        <Switch onClick={() => dispatch(toggleSort())}/>\r\n        <Reset title=\"Reset\" onClick={() => dispatch(reset())}/>\r\n        <div className={styles.scrollableY}>\r\n          <ol className={styles.moves}>{moves}</ol>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { initializeApp } from 'firebase/app';\r\nimport { getFirestore } from 'firebase/firestore/lite';\r\n\r\nconst firebaseConfig = {\r\n  apiKey: \"AIzaSyDVe3axD8Y3GnxcnsnDuDz_FHCKYJcu6gg\",\r\n  authDomain: \"redux-project-98a9a.firebaseapp.com\",\r\n  databaseURL: \"https://redux-project-98a9a-default-rtdb.europe-west1.firebasedatabase.app/\",\r\n  projectId: \"redux-project-98a9a\",\r\n  storageBucket: \"redux-project-98a9a.appspot.com\",\r\n  messagingSenderId: \"67646127878\",\r\n  appId: \"1:67646127878:web:507ecc4c86993503ca2887\",\r\n  measurementId: \"G-34QJSE84ZR\"\r\n};\r\n\r\nconst app = initializeApp(firebaseConfig);\r\nconst base = getFirestore(app);\r\n\r\nexport default base;","import { getDatabase, ref, get} from \"firebase/database\";\r\n\r\nexport function readPlayers() {\r\n\tconst db = getDatabase();\r\n  return new Promise((resolve) => {  \t\r\n\t\tget(ref(db, `/players`)).then((players) => {\r\n\t\t\tif (players.exists()) {\r\n\t\t\t\tresolve(players.val());    \r\n\t\t  } else {\r\n\t\t    console.log(\"No data available\");\r\n\t\t  }\r\n\t\t}).catch((error) => {\r\n\t\t  console.error(error);\r\n\t\t});\r\n  });\r\n}\r\n\r\nexport function compareGameState(turnData) {\r\n\tconst db = getDatabase();\r\n  return new Promise((resolve) => {\r\n\t\tget(ref(db, `/turnAction`)).then((readTurnAction) => {\r\n\t\t\tif (readTurnAction.exists()) {\r\n\t\t\t\tget(ref(db, `/stepNumber`)).then((readStepNumber) => {\r\n\t\t\t\t\tif (readStepNumber.exists()) {\r\n\t\t        if(readTurnAction.val() !== turnData.turnAction || readStepNumber.val() !== turnData.stepNumber) {\r\n\t\t\t\t\t    get(ref(db, `/`)).then((dataSnapshot) => {\r\n\t\t\t\t\t\t\t\tif (dataSnapshot.exists()) {\r\n\t\t\t        \t\tresolve(dataSnapshot.val());\r\n\t\t\t\t\t\t\t  } else {\r\n\t\t\t\t\t\t\t    console.log(\"No data available\");\r\n\t\t\t\t\t\t\t  }\r\n\t\t\t\t\t    }).catch((error) => {\r\n\t\t\t\t\t\t\t  console.error(error);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t    }\r\n\t\t\t\t  } else {\r\n\t\t\t\t    console.log(\"No data available\");\r\n\t\t\t\t  }\r\n\t\t\t\t}).catch((error) => {\r\n\t\t\t\t  console.error(error);\r\n\t\t\t\t});\t\t\t\t\r\n\t\t  } else {\r\n\t\t    console.log(\"No data available\");\r\n\t\t  }\r\n\t\t}).catch((error) => {\r\n\t\t  console.error(error);\r\n\t\t});\r\n\t});\r\n}\r\n\r\nexport function readGamePlayers() {\r\n\tconst db = getDatabase();\r\n  return new Promise((resolve) => {  \t\r\n\t\tget(ref(db, `/players`)).then((players) => {\r\n\t\t\tif (players.exists()) {\r\n\t\t\t\tget(ref(db, `/gameIsOn`)).then((snapshot) => {\r\n\t\t\t\t\tif (snapshot.exists()) {\r\n\t\t\t\t    resolve({players: players.val(), gameIsOn: snapshot.val()});\r\n\t\t\t\t  } else {\r\n\t\t\t\t    console.log(\"No data available\");\r\n\t\t\t\t  }\r\n\t\t\t\t}).catch((error) => {\r\n\t\t\t\t  console.error(error);\r\n\t\t\t\t});\t\t    \r\n\t\t  } else {\r\n\t\t    console.log(\"No data available\");\r\n\t\t  }\r\n\t\t}).catch((error) => {\r\n\t\t  console.error(error);\r\n\t\t});\r\n  });\r\n}\r\n","import { createAsyncThunk, createSlice } from '@reduxjs/toolkit';\r\nimport { getDatabase, ref, set, push, remove } from \"firebase/database\";\r\nimport '../../base';\r\nimport { loadState } from '../../localStorage';\r\nimport { compareGameState,  readGamePlayers, readPlayers} from './connectXAPI';\r\n\r\nconst initialState = {\r\n  history: [{\r\n    slots: Array(42).fill(0),\r\n    boardFlip: 0,\r\n  }],\r\n  turnAction: {number:0, action:0},\r\n  stepNumber: 0,\r\n  gameSettings: {\r\n    width: 7,\r\n    height: 6,\r\n    scoreTarget: 4 \r\n  },\r\n  currentSign: 'X',\r\n  sortIsAsc: true,\r\n  gravIsOn: true,\r\n  transitions: {slots:0, board:0},\r\n  players: [],\r\n};\r\n\r\nconst actionsPerTurn = 2;\r\n\r\nexport const initPlayersAsync = createAsyncThunk(\r\n  'connectX/readPlayers',\r\n  async (arg, thunkAPI) => {\r\n    let response = await readPlayers();\r\n    if (!response) response = [];\r\n    const playerCount = Object.keys(response).length;    \r\n    if (playerCount > 2) {\r\n      thunkAPI.dispatch(removePlayers());\r\n      thunkAPI.dispatch(requestGame(loadState()));\r\n      response = [];\r\n    }\r\n    return response;\r\n  }\r\n);\r\n\r\nexport const updateStateAsync = createAsyncThunk(\r\n  'connectX/compareGameState',\r\n  async (turnData) => {\r\n    const response = await compareGameState(turnData);\r\n    return response;\r\n  }\r\n);\r\n\r\nexport const requestGameAsync = createAsyncThunk(\r\n  'connectX/readGamePlayers',\r\n  async (arg, thunkAPI) => {\r\n    const response = await readGamePlayers();\r\n    let players = response.players;\r\n    const playerCount = Object.keys(players).length;\r\n\r\n    if (playerCount === 1) {\r\n      set(ref(getDatabase(), '/gameIsOn/'), false);  \r\n    } else if (playerCount === 2) {\r\n      if (response.gameIsOn) {\r\n        thunkAPI.dispatch(reset(false));\r\n      } else {\r\n        thunkAPI.dispatch(reset(true));\r\n      }\r\n    }\r\n    if (playerCount > 2) {\r\n      thunkAPI.dispatch(removePlayers());\r\n      thunkAPI.dispatch(requestGame(loadState()));\r\n      players = [];\r\n    } \r\n    return players;\r\n  }\r\n);\r\n\r\nexport const connectXSlice = createSlice({\r\n  name: 'connectX',\r\n  initialState,\r\n  // The `reducers` field lets us define reducers and generate associated actions\r\n  reducers: {\r\n    fillSlot: (state, action) => {\r\n      // We ensure the erasure of any \"future\" steps if the game is resumed from a history move\r\n      const data = action.payload;\r\n      let stepNumber = data.stepNumber;\r\n      let history = data.history;\r\n      const current = data.current;\r\n      const slots = data.slots;\r\n      const slotIndex = data.slotIndex;\r\n      const slotValue = state.currentSign;\r\n\r\n      slots[slotIndex] = slotValue;\r\n\r\n      const turnAction = state.turnAction;\r\n      const startOfTurn = !turnAction.action;\r\n      if (startOfTurn) stepNumber++;\r\n      state.stepNumber = stepNumber;\r\n\r\n      const isEndTurn = turnAction.number + 1 === actionsPerTurn;\r\n      const gravIsOff = !state.gravIsOn;\r\n      if (isEndTurn && gravIsOff) {\r\n        state.turnAction = {number:0, action:0};\r\n        state.currentSign = slotValue === 'X' ? 'O' : 'X';\r\n      } else {\r\n        state.turnAction.number += 1;\r\n        state.turnAction.action = 1;\r\n      }\r\n    // state.transitions = transitions && transitions.find(e => e !== 0) !== -1 ? {slots: transitions, board: 0} : {slots:0, board:0};\r\n      // We add the current board to the history, and assign the stepNumber based on the new history\r\n      history = history.slice(0, stepNumber);      \r\n      state.history = history.concat([{slots: slots, boardFlip: current.boardFlip}]);\r\n\r\n      if (state.players && state.players.length === 2) {\r\n        console.log(\"set db fillSlot\");\r\n        const db = getDatabase();\r\n        let baseRef = ref(db, '/stepNumber/');\r\n        if (startOfTurn) {\r\n          set(baseRef, stepNumber);\r\n        }\r\n        if (gravIsOff) {\r\n          baseRef = ref(db, `/history/${stepNumber}`);\r\n          set(baseRef, {slots: slots, boardFlip: current.boardFlip});\r\n          if (isEndTurn) {\r\n            baseRef = ref(db, '/currentSign/');\r\n            set(baseRef, state.currentSign);        \r\n          }\r\n          baseRef = ref(db, '/turnAction/');\r\n          set(baseRef, state.turnAction.number);\r\n          baseRef = ref(db, '/transitions/');\r\n          set(baseRef, {slots:0, board:0});        \r\n        }\r\n      }\r\n    },\r\n\r\n    toggleGravity: (state, action) => {\r\n      const slotIndex = action.payload.slotIndex;\r\n      const singleSlotMode = typeof slotIndex === 'undefined' ? false : true;\r\n\r\n      // We get the slots of the currently displayed move\r\n      let stepNumber = state.stepNumber;  \r\n      let history = state.history.slice(0, stepNumber + 1);\r\n      const current = history[stepNumber];\r\n      const slots = current.slots.slice();\r\n\r\n      const isAction = action.payload.toggle;\r\n      const turnAction = state.turnAction;\r\n      let isEndTurn;\r\n      if (isAction) {\r\n        state.gravIsOn = state.gravIsOn ? false : true;\r\n        isEndTurn = turnAction.number + 1 === actionsPerTurn;\r\n      } else {\r\n        isEndTurn = turnAction.number === actionsPerTurn\r\n      }\r\n\r\n      const gravIsOn = state.gravIsOn;\r\n      if (gravIsOn) {\r\n        let width = state.gameSettings.width,\r\n            height = state.gameSettings.height;\r\n        if (current.boardFlip % 2 !== 0) {\r\n          width = state.gameSettings.height;\r\n          height = state.gameSettings.width;\r\n        }\r\n\r\n        let count = 1; \r\n        if (singleSlotMode) {\r\n          var slotScore = 0;\r\n          // We start iterating at the second to last row\r\n          for(let i = height - 1; i > 0; i--) {\r\n            // We then determine the height the slot sits at by testing its index,\r\n            // we make it a score that represents the distance that this slot can be potentially pushed down\r\n            if(slotIndex >= (i - 1) * width && slotIndex <= i * width - 1) {\r\n              slotScore = height - i;\r\n              break;\r\n            }\r\n          }        \r\n          count = slotScore;\r\n        }\r\n        var transitions = Array(width * height).fill(0);\r\n        // We iterate through every rows, counting it (count), starting from the second to last one and going up\r\n        for (let i = slots.length - 1 - count * width; i >= 0; i -= width) {\r\n          // We then iterate through each row, to get to each and every slot\r\n          for (let j = 0; j < width; j++) {\r\n            // We store (count) as a relative height we're at from the first row we go through,\r\n            // giving us a score (l) of how many slots we'll try to \"push down\" the value of the slot.\r\n            // If it fails, we loop and try to push it one slot shorter\r\n            let index = i - j;\r\n            if (slots[index] && (!singleSlotMode || slotIndex === index)) {\r\n              for (let l = count; l > 0; l--) {\r\n                const targetIndex = index + width * l;\r\n                if(!slots[targetIndex]) {\r\n                  // If the slot is filled and the destination is free, we switch the values\r\n                  // (l) provides the height indication for the animation\r\n                  slots[targetIndex] = slots[index];\r\n                  slots[index] = 0;\r\n                  transitions[targetIndex] = l;\r\n                  break;\r\n                }\r\n              }\r\n              if (slotIndex === index) break;\r\n            }\r\n          }\r\n          if (singleSlotMode) break;\r\n          count++;\r\n        }\r\n      }\r\n\r\n      const startOfTurn = !turnAction.action;\r\n      if (startOfTurn) stepNumber++;\r\n      state.stepNumber = stepNumber;\r\n      if (isEndTurn) {\r\n        state.turnAction = {number:0, action:0};\r\n        state.currentSign = state.currentSign === 'X' ? 'O' : 'X';        \r\n      } else {\r\n        state.turnAction.number = isAction ? turnAction.number + 1 : turnAction.number;\r\n        state.turnAction.action = isAction ? 2 : turnAction.action;\r\n      }\r\n\r\n      history = history.slice(0, stepNumber);\r\n      state.history = history.concat([{slots: slots, boardFlip: current.boardFlip}]);\r\n\r\n      // We check if there is any slotScore > 0 so we dont expect a transition callback when there isn't\r\n      const hasTransitions = transitions && transitions.filter(el => {return el !== 0;}).length > 0 ? true : false;\r\n      // If the toggle was called with a click, we clear the board transition,\r\n      // if the gravity is turned off, we clear the slots transitions\r\n      state.transitions = {slots: gravIsOn ? hasTransitions ? transitions : 0 : 0, board: isAction ? 0 : turnAction.action !== 3 ? 0 : state.transitions.board};\r\n      if (state.players && state.players.length === 2) {  \r\n        console.log(\"set db toggleGravity\"); \r\n        const db = getDatabase();    \r\n        let baseRef = ref(db, '/gravIsOn/');\r\n        if (isAction) {\r\n          set(baseRef, gravIsOn);\r\n        }\r\n        baseRef = ref(db, `/history/${stepNumber}`);\r\n        set(baseRef, {slots: slots, boardFlip: current.boardFlip});\r\n        if (startOfTurn) {\r\n          baseRef = ref(db, '/stepNumber/');\r\n          set(baseRef, stepNumber);\r\n        }\r\n        if (isEndTurn) {\r\n          baseRef = ref(db, '/currentSign/');\r\n          set(baseRef, state.currentSign);\r\n        }          \r\n        baseRef = ref(db, '/turnAction/');\r\n        set(baseRef, state.turnAction.number);\r\n        baseRef = ref(db, '/transitions/');\r\n        set(baseRef, state.transitions);\r\n      }  \r\n    },\r\n\r\n    flipBoardState: (state, action) => {\r\n      // Modify the way the values are placed inside the slots and replace the current history move with it\r\n\r\n      // We get the slots of the currently displayed move\r\n      let stepNumber = state.stepNumber;      \r\n      let history = state.history.slice(0, stepNumber + 1);\r\n      const current = history[stepNumber];\r\n      const slots = current.slots.slice();\r\n\r\n      // We deduce the future flip state of the board with the payload (1 ou -1)\r\n      const flipValue = action.payload;\r\n      let boardFlip = current.boardFlip + flipValue;\r\n      if (boardFlip === -1) boardFlip = 3;\r\n      if (boardFlip === 4) boardFlip = 0;\r\n\r\n      // Adjust the board params to that flip state to iterate through properly through the future board\r\n      let width = state.gameSettings.width,\r\n          height = state.gameSettings.height;\r\n      if (current.boardFlip % 2 !== 0) {\r\n        width = state.gameSettings.height;\r\n        height = state.gameSettings.width;\r\n      }\r\n\r\n      let newSlots = slots.slice();\r\n      let rowCount = height;\r\n      // We iterate through every rows, counting it (count)\r\n      for (let i = slots.length - 1; i >= 0; i -= width) {\r\n        // We then iterate through each row, to get to each and every slot\r\n        for (let j = 0; j < width; j++) {\r\n          const index = i - j;\r\n          // Here are the two formulaes corresponding to flipping the board clockwise and counter clockwise\r\n          // They take the initial index of the slot as well as the number of the row it sits in (first row = 1) as parameters\r\n          const newIndex = flipValue === 1 ? height * (index + 1 - (rowCount - 1) * width) - rowCount : height * (rowCount * width - 1 - index) + rowCount - 1;\r\n          newSlots[newIndex] = slots[index];\r\n        }\r\n        rowCount--;\r\n      }\r\n\r\n      const turnAction = state.turnAction;\r\n      const startOfTurn = !turnAction.action;\r\n      if (startOfTurn) stepNumber++;        \r\n      state.stepNumber = stepNumber;\r\n      \r\n      const isEndTurn = turnAction.number + 1 === actionsPerTurn;\r\n      const gravIsOff = !state.gravIsOn;\r\n\r\n      if (isEndTurn && gravIsOff) {\r\n        state.turnAction = {number:0, action:0};\r\n        state.currentSign = state.currentSign === 'X' ? 'O' : 'X';        \r\n      } else {\r\n        state.turnAction.number += 1;\r\n        state.turnAction.action = 3;\r\n      }\r\n\r\n      history = history.slice(0, stepNumber);\r\n      state.history = history.concat([{slots: newSlots, boardFlip: boardFlip}]);\r\n      state.transitions = {slots: 0, board: flipValue * -90};\r\n\r\n      if (state.players && state.players.length === 2) {\r\n        console.log(\"set db flipBoard\");\r\n        const db = getDatabase();\r\n        let baseRef = ref(db, '/stepNumber/');\r\n        if (startOfTurn) {\r\n          set(baseRef, stepNumber);\r\n        }\r\n        if (gravIsOff) {\r\n          baseRef = ref(db, `/history/${stepNumber}`);\r\n          set(baseRef, {slots: slots, boardFlip: current.boardFlip});\r\n          if (isEndTurn) {\r\n            baseRef = ref(db, '/currentSign/');\r\n            set(baseRef, state.currentSign);        \r\n          }\r\n          baseRef = ref(db, '/turnAction/');\r\n          set(baseRef, state.turnAction.number);\r\n          baseRef = ref(db, '/transitions/');\r\n          set(baseRef, state.transitions);        \r\n        }\r\n      } \r\n    },\r\n\r\n    endTurn: (state) => {\r\n      const turnAction = {number:0, action:0};\r\n      state.turnAction = turnAction;\r\n      state.currentSign = state.currentSign === 'X' ? 'O' : 'X';\r\n      const transitions = {slots: 0, board: 0};\r\n      state.transitions = transitions;\r\n      if (state.players && state.players.length === 2) {\r\n        console.log(\"set db endTurn\");\r\n        const db = getDatabase();\r\n        let baseRef = ref(db, '/turnAction/');\r\n        set(baseRef, turnAction.number);\r\n        baseRef = ref(db, '/currentSign/');\r\n        set(baseRef, state.currentSign);\r\n        baseRef = ref(db, '/transitions/');\r\n        set(baseRef, transitions);\r\n      }\r\n    },\r\n\r\n    changeStep: (state, action) => {\r\n      state.stepNumber = action.payload;\r\n      state.currentSign = state.stepNumber % 2 === 0 ? 'X' : 'O';      \r\n      state.turnAction = {number:0, action:0};          \r\n      state.transitions = {slots:0, board:0};\r\n    },\r\n\r\n    toggleSort: (state) => {\r\n      state.sortIsAsc = state.sortIsAsc ? false : true;\r\n      state.transitions = {slots:0, board:0};\r\n    },\r\n\r\n    setGameSettings: (state, action) => {\r\n      const settings = action.payload;\r\n      state.gameSettings = settings;\r\n      state.history = [{\r\n        slots: Array(settings.width * settings.height).fill(0),\r\n        boardFlip: 0\r\n      }];\r\n    },\r\n\r\n    reset: (state, action) => {\r\n      const isDbReset = action.payload;\r\n      const history = state.history.slice(0,1);\r\n      history[0].boardFlip = 0;\r\n      const transitions = {slots:0, board:0};        \r\n      if (isDbReset) {\r\n        const db = getDatabase();\r\n        let baseRef = ref(db, '/stepNumber/');\r\n        set(baseRef, 0);\r\n        baseRef = ref(db, '/history/');\r\n        set(baseRef, history);   \r\n        baseRef = ref(db, '/turnAction/');\r\n        set(baseRef, 0);        \r\n        baseRef = ref(db, '/currentSign/');\r\n        set(baseRef, 'X');      \r\n        baseRef = ref(db, '/transitions/');\r\n        set(baseRef, transitions);\r\n        baseRef = ref(db, '/gravIsOn/');\r\n        set(baseRef, true);\r\n        baseRef = ref(db, '/gameIsOn/');\r\n        set(baseRef, true);        \r\n      }\r\n      state.stepNumber = 0;\r\n      state.history = history;\r\n      state.currentSign = 'X';      \r\n      state.turnAction = {number:0, action:0};      \r\n      state.transitions = transitions;\r\n      state.gravIsOn = true;\r\n    },\r\n\r\n    removePlayers: (state) => {\r\n      // As this is called on window.onunload, we only have time for one call to be made\r\n      const db = getDatabase();\r\n      set(ref(db, '/players/'),0);\r\n    }\r\n  },\r\n\r\n  extraReducers: (builder) => {\r\n    builder\r\n      .addCase(updateStateAsync.pending, (state) => {\r\n        console.log(\"updateStateAsync pending\");\r\n      })\r\n      .addCase(updateStateAsync.fulfilled, (state, action) => {\r\n        const data = action.payload;\r\n        console.log(\"updateStateAsync\",data);\r\n\r\n        if (data === 0) {\r\n          window.alert('Your opponent left! Reload the page to exit the current game');\r\n          state.players = [];\r\n        } else {\r\n          state.history = data.history;\r\n          state.stepNumber = data.stepNumber;\r\n          const transitions = data.transitions;\r\n          state.transitions = {slots: transitions.slots, board: transitions.board};\r\n          state.gravIsOn = data.gravIsOn;\r\n          const turnAction = data.turnAction;\r\n          state.turnAction.number = turnAction === actionsPerTurn ? 0 : turnAction;\r\n          state.currentSign = data.currentSign;\r\n        }\r\n      })\r\n      .addCase(requestGameAsync.pending, (state) => {\r\n        console.log(\"requestGameAsync pending\");\r\n      })      \r\n      .addCase(requestGameAsync.fulfilled, (state, action) => {\r\n        const players = action.payload;\r\n        console.log(\"requestGameAsync\",players);\r\n        const playersRefs = Object.keys(players);\r\n\r\n        if(playersRefs.length === 0) {\r\n          // state.players = [];\r\n          // window.alert('There was an issue, please try again!');          \r\n        } else if(playersRefs.length === 1) {  \r\n          state.players = [{pseudo: players[playersRefs[0]].pseudo, sign: 'O'}];\r\n          state.transitions = {slots:0, board:0};\r\n        } else if (playersRefs.length === 2) {\r\n          state.players = [{pseudo: players[playersRefs[0]].pseudo, sign: 'O'},\r\n                           {pseudo: players[playersRefs[1]].pseudo, sign: 'X'}];          \r\n        }\r\n      })\r\n      .addCase(initPlayersAsync.pending, (state) => {\r\n        console.log(\"initPlayersAsync pending\");\r\n      })      \r\n      .addCase(initPlayersAsync.fulfilled, (state, action) => {\r\n        const players = action.payload;\r\n        console.log(\"initPlayersAsync\",players);\r\n        const playersRefs = Object.keys(players);\r\n\r\n        if(playersRefs.length === 0) {\r\n          state.players = null;     \r\n        } else if(playersRefs.length === 1) {  \r\n          state.players = [{pseudo: players[playersRefs[0]].pseudo, sign: 'O'}];\r\n        } else if (playersRefs.length === 2) {\r\n          state.players = [{pseudo: players[playersRefs[0]].pseudo, sign: 'O'},\r\n                           {pseudo: players[playersRefs[1]].pseudo, sign: 'X'}];          \r\n        }\r\n\r\n      });\r\n  }  \r\n});\r\n\r\nexport const {\r\n  fillSlot,\r\n  changeStep,\r\n  toggleSort,\r\n  toggleGravity,\r\n  flipBoardState,\r\n  endTurn,\r\n  setGameSettings,\r\n  reset,\r\n  removePlayers,\r\n} = connectXSlice.actions;\r\n\r\n// The function below is called a selector and allows us to select a value from\r\n// the state. Selectors can also be defined inline where they're used instead of\r\n// in the slice file. For example: `useSelector((state: RootState) => state.connectX.value)`\r\nexport const selectHistory = (state) => state.connectX.history;\r\nexport const selectGameSettings = (state) => state.connectX.gameSettings;\r\nexport const selectStepNumber = (state) => state.connectX.stepNumber;\r\nexport const selectSortIsAsc = (state) => state.connectX.sortIsAsc;\r\nexport const selectGravityState = (state) => state.connectX.gravIsOn;\r\nexport const selectTransitions = (state) => state.connectX.transitions;\r\nexport const selectCurrentSign = (state) => state.connectX.currentSign;\r\nexport const selectPlayers = (state) => state.connectX.players;\r\nexport const selectTurnAction = (state) => state.connectX.turnAction;\r\n\r\n\r\nexport const playSlot = (slotIndex) => (dispatch, getState) => {\r\n  const stepNumber = selectStepNumber(getState());\r\n  const history = selectHistory(getState()).slice(0, stepNumber + 1);\r\n  const current = history[stepNumber];    \r\n  const slots = current.slots.slice();\r\n  const gravIsOn = selectGravityState(getState());\r\n  // Can't play a slot if it has already been played\r\n  if (slots[slotIndex]) return; \r\n\r\n  const data = {stepNumber, history, current, slots, slotIndex, gravIsOn};\r\n  dispatch(fillSlot(data));\r\n\r\n  if(gravIsOn) {\r\n    dispatch(toggleGravity({toggle:false, slotIndex}));\r\n  }\r\n};\r\n\r\nexport const flipBoard = (direction) => (dispatch, getState) => {\r\n  dispatch(flipBoardState(direction));\r\n  if(selectGravityState(getState())) {\r\n    dispatch(toggleGravity({toggle:false}));\r\n  }\r\n};\r\n\r\nexport const jumpTo = (stepNumber) => (dispatch, getState) => {\r\n  if (selectPlayers(getState()).length < 2) { \r\n    dispatch(changeStep(stepNumber));\r\n    if(selectGravityState(getState())) {\r\n      dispatch(toggleGravity({toggle:false}));\r\n    }\r\n  }\r\n};\r\n\r\nexport const sendGameSettings = (settings) => (dispatch) => {\r\n  dispatch(reset());\r\n  dispatch(setGameSettings(settings));\r\n};\r\n\r\n// CALL TO ASYNC\r\nexport const initPlayers = (players) => (dispatch) => {\r\n  dispatch(initPlayersAsync());\r\n};\r\n\r\nexport const requestGame = (pseudo) => (dispatch, getState) => {\r\n  set(push(ref(getDatabase(), 'players')), {\r\n    pseudo\r\n  })\r\n  .then(() => {\r\n    dispatch(requestGameAsync());\r\n    const watchTimer = setInterval(() => {\r\n      if (selectPlayers(getState()).length < 2) {\r\n        dispatch(requestGameAsync());\r\n      } else {\r\n        clearInterval(watchTimer);\r\n      }\r\n    }, 4000);\r\n  })\r\n  .catch((error) => {\r\n    // The write failed...\r\n  });\r\n};\r\n\r\nexport const watchGame = (mySign) => (dispatch, getState) => {\r\n  const turnData = {turnAction: selectTurnAction(getState()).number, stepNumber: selectStepNumber(getState())};\r\n  const isMyTurn = mySign === selectCurrentSign(getState()) ? true : false;\r\n\r\n  const watchTimer = setInterval(() => {\r\n    if (!isMyTurn) {\r\n      dispatch(updateStateAsync(turnData));\r\n    } else {\r\n      clearInterval(watchTimer);\r\n    }    \r\n  }, 4000);\r\n};    \r\n\r\nexport default connectXSlice.reducer;\r\n","import React from 'react';\r\n// CSS\r\nimport styles from '../ConnectX.module.css';\r\n\r\nfunction Slot(props) {\r\n\r\n\t\t// FALL ANIMATION //\r\n\t\tconst slotScore = props.slotScore;\r\n\t\tlet transitionClass = \"\";\r\n\t\tlet speed = 0\r\n\t\tif (slotScore) {\r\n\t\t\ttransitionClass = `hasTransition ${styles.fall}`;\r\n\t\t\tspeed = Math.round((0.16 + 0.189 * Math.log(slotScore)) * 10) / 10;\r\n\t\t}\r\n\r\n\t\t// DISPLAY SLOT CONTENT //\r\n    const contentClass = props.value ? `${styles.slotContent} ${props.value === 'X' ? styles.slotContentX : styles.slotContentO}` : \"\";\r\n    \r\n    // DISPLAY WIN //\r\n    const winClass = props.winStyle ? \"wonSlot\" : \"\";\r\n    let coeff = -1;\r\n  return (\r\n    <button\r\n    \tclassName={`${styles.slot} ${winClass}`}\r\n    \tonClick={props.onClick}\r\n    >\r\n      <div \tstyle={{'--slotStartPos': `calc(${coeff * slotScore * 125}% + ${slotScore}px)`,'--speed': `${speed}s`}}\r\n\t\t\t\t\t\tclassName={`${contentClass} ${transitionClass}`} onTransitionEnd={props.handleTransitionEnd}>\r\n      </div>\r\n    </button>\r\n  );\r\n}\r\n\r\nexport default Slot;","// CSS\r\nimport styles from './ConnectX.module.css';\r\n\r\n// WIN DISPLAY //\r\nexport function styleWin() {\r\n  const slots = Array.from(document.querySelectorAll('.wonSlot'));\r\n  console.log(slots);\r\n  slots.forEach(e => {\r\n    e.classList.add(styles.win);\r\n  });    \r\n};\r\n\r\n// LAUNCH TRANSITIONS //\r\nexport function animateBoards() {\r\n  // We get all elements with the transition class\r\n  const animatedElements = Array.from(document.querySelectorAll('.hasTransition'));\r\n  animatedElements.forEach(e => {\r\n    // First we clear out the class on the previously animated elements\r\n    e.classList.remove(styles.animate);\r\n    // We trust the transitions for animations happening after this update\r\n    setTimeout(() => { e.classList.add(styles.animate); }, 0);\r\n  });\r\n};\r\n","import React from 'react';\r\nimport Slot from './Slot';\r\n\r\n// STYLE\r\nimport { animateBoards, styleWin } from '../ConnectXTransitions.js';\r\nimport styles from '../ConnectX.module.css';\r\n\r\nclass Board extends React.Component {\r\n\r\n  // ANIMATION & WIN TRIGGER //\r\n  componentDidUpdate() {\r\n    // We use this hook to manipulate the transitions on the dom elements \r\n    const transitions = this.props.transitions;\r\n    if(this.props.isMainBoard) {\r\n\r\n      // If transitions are present, we play them\r\n      if (transitions && (transitions.slots || transitions.board)) {\r\n        animateBoards();\r\n      } else {\r\n        // If there's none, we directly style the winning slots\r\n        if(this.props.winIndexes.length) styleWin();\r\n      }\r\n    }\r\n  }\r\n\r\n  // TRANSITIONS CALLBACK //\r\n  handleTransitionEnd = (event) => {\r\n    // We wait for the end of the transitions to style the winning slots\r\n    if(this.props.winIndexes.length) styleWin();\r\n  };\r\n\r\n  // PREPARE THE SLOT //\r\n  renderSlot = (i, isBoardWon, transition) => {\r\n    // We deactivate the handleclick action if the board is won\r\n    const onClickFunc = isBoardWon ? undefined : () => this.props.onClick(i);\r\n\r\n    // Determine if the slot is part of a winning streak\r\n    const winIndexes = isBoardWon ? this.props.winIndexes : null;\r\n    const winStyle = winIndexes && winIndexes.includes(i) ? true : false;\r\n\r\n    let slotScore = 0;\r\n    let animationCallback;\r\n    if(transition) {\r\n      // Assign the slot a score based on the animation map: the higher the score, the longer the animation \r\n      slotScore = transition;\r\n      if(winStyle) { // For now we only put the callback to style a win \r\n        const transitions = this.props.transitions.slots;\r\n        // Sort out the null elements, then sort in descending order the slotScores that are left inside\r\n        // and take out the first value, which indicates the maximum animation score for this render\r\n        const maxScore = transitions.filter(el => {return el !== 0;}).sort((a, b) => b - a)[0];\r\n        // Finds the first index with a maxScore in the map and check if it corresponds to the current index\r\n        const isFirstMaxScoreSlot = i === transitions.findIndex(e => e === maxScore);\r\n        // We make this slot a reference for the longest animation and put the callback onto it\r\n        if(isFirstMaxScoreSlot) animationCallback = (i) => this.handleTransitionEnd(i);\r\n      }\r\n    }\r\n    return (\r\n      <Slot\r\n        key={i}\r\n        value={this.props.slots[i]}\r\n        onClick={onClickFunc}\r\n        slotScore={slotScore}\r\n        winStyle={winStyle}\r\n        handleTransitionEnd={animationCallback}\r\n      /> \r\n    );\r\n  }\r\n\r\n  // STRUCTURE THE SLOTS AND STYLE THE BOARD  //\r\n  createBoard = (boardParams, isMainBoard, isBoardWon) => {\r\n    let board = []\r\n    let index = 0;\r\n    const transitions = this.props.transitions;\r\n    const slotTransitions = transitions ? this.props.transitions.slots : null;\r\n    let slotTransition = 0;\r\n    // Outer loop adding the full rows to the board\r\n    for (let i = 0; i < boardParams.height; i++) {\r\n      let slots = [];\r\n      // Inner loop creating the slots of the rows\r\n      for (let j = 0; j < boardParams.width; j++) {\r\n        if (slotTransitions) slotTransition = slotTransitions[index];\r\n        slots.push(this.renderSlot(index, isBoardWon, slotTransition));\r\n        index++;\r\n      }\r\n      // At the end of the outer loop, we encapsulate our slots in row\r\n      board.push(<div key={i} className={styles.board_row}>{slots}</div>)\r\n    }\r\n\r\n    const startAngle = transitions ? this.props.transitions.board : 0;\r\n\r\n    return (\r\n      <div style={{'--boardStartPos': `rotateZ(${startAngle}deg)`}}\r\n          className={`\r\n              ${startAngle === 0 ? \"\" : `hasTransition ${styles.flip}`} \r\n              ${styles.board} \r\n              ${isMainBoard ? styles.main_board : \"\"} \r\n              ${this.props.isSelected ? styles.selected : \"\"}\r\n            `}\r\n          onTransitionEnd={isMainBoard && isBoardWon ? () => this.handleTransitionEnd() : undefined} >\r\n        {board}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // RETURN THE BOARD'S OWN CSS VARIABLES //\r\n  styleBoard = (size, boardParams) => {\r\n    // Align the size of the board to fit the slots  \r\n    // Arbitrary decision to occupy (X%) amount of space in the viewport\r\n    // Calculate two sizes for the slot based on the available space on both axes in the viewport\r\n    let slotSize = Math.floor(window.innerHeight * 0.55 / (boardParams.height * size));\r\n    let slotSizeDiff = Math.floor(window.innerHeight * 0.55 / (boardParams.width * size));\r\n    // let slotSizeDiff = Math.floor(window.innerWidth * 0.8 / (boardParams.width * size));\r\n\r\n    // The final size will be the smallest of the two, as we want the board to fit inside the viewport\r\n    slotSize = slotSize <= slotSizeDiff ? slotSize : slotSizeDiff;\r\n\r\n    // let fontSize = Math.round((boardWidth / 15.22) * Math.pow(this.props.boardParams.width, -1) * 10 /*/ size*/) / 10;\r\n    let fontSize = Math.round((boardParams.height / 130) * 10 /*/ size*/) / 10;\r\n    if (fontSize <= 0.5) fontSize = 0;\r\n\r\n    return {\r\n      '--boardWidth': slotSize * boardParams.width + 'px',\r\n      '--boardHeight': slotSize * boardParams.height + 'px',\r\n      // We use margin-right: -1px to merge the borders together on the boards, so we bump the slot size by 1 to compensate\r\n      '--slotSize': (slotSize + 1) + 'px',\r\n      '--fontSize': fontSize + 'em'\r\n    }\r\n  };\r\n\r\n  render() {\r\n    // The board flip indicates us which dimension to take as which for the board\r\n    let boardParams = this.props.boardParams;\r\n    if (this.props.flip % 2 !== 0) {\r\n      boardParams = {width: boardParams.height, height: boardParams.width};\r\n    }\r\n\r\n    const isMainBoard = this.props.isMainBoard;\r\n    // Display a title under the history moves\r\n    const title = isMainBoard ? \"\" : this.props.title;\r\n\r\n    const isBoardWon = isMainBoard && this.props.winIndexes.length ? true : false;   \r\n    // We tweak the style of the board depending on it being the main one or not\r\n    // styleBoard(n, params) styles the board at a 1:n ratio\r\n    return (\r\n      <div style={isMainBoard ? this.styleBoard(1, boardParams) : this.styleBoard(4, boardParams)} \r\n          className={isMainBoard ? styles.main : \"\"}>\r\n        {this.createBoard(boardParams, isMainBoard, isBoardWon)}\r\n        <p className={styles.title}>{title}</p>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Board;","import React from 'react';\r\n// CSS\r\nimport styles from '../ConnectX.module.css';\r\n\r\nclass Form extends React.Component {\r\n\tprepareInfos = event => {\r\n\t\tevent.preventDefault();\r\n\t\tconst width = parseInt(this.width.value);\r\n\t\tconst height = parseInt(this.height.value);\r\n\t\tconst minVal = width <= height ? width : height;\r\n\t\tconst scoreTarget = Math.round(0.8 + 1.7 * Math.log((width + height) / 2));\r\n\t\tconst gameInfos = {\r\n\t\t\twidth: width,\r\n\t\t\theight: height,\r\n\t\t\tscoreTarget: minVal <= scoreTarget ? minVal : scoreTarget\r\n\t\t\t// scoreTarget: parseInt(this.scoreTarget.value)\r\n\t\t};\r\n\t\tthis.props.sendGameSettings(gameInfos);\r\n\r\n\t\t// We clear the textarea\r\n\t\tthis.infosForm.reset();\r\n\t};\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<form \r\n\t\t\t\tclassName={styles.form}\r\n\t\t\t\tonSubmit={i => this.prepareInfos(i)}\r\n\t\t\t\tref={i => this.infosForm = i}\r\n\t\t\t>\r\n\r\n\t\t\t\t<input\r\n\t\t\t\t\ttype=\"text\" pattern=\"\\b([3-9]|[12][0-9]|3[0-2])\\b\"\r\n\t\t\t\t\tmaxLength={this.props.length}\r\n\t\t\t\t\tref={i => this.width = i}\r\n\t\t\t\t/>\r\n\t\t\t\t<input\r\n\t\t\t\t\ttype=\"text\" pattern=\"\\b([3-9]|[12][0-9]|3[0-2])\\b\"\r\n\t\t\t\t\tmaxLength={this.props.length}\r\n\t\t\t\t\tref={i => this.height = i}\r\n\t\t\t\t/>\t\t\t\t\r\n{/*\t\t\t\t<input\r\n\t\t\t\t\ttype=\"text\" pattern=\"[0-9]*\"\r\n\t\t\t\t\tmaxLength={this.props.length}\r\n\t\t\t\t\tref={i => this.scoreTarget = i}\r\n\t\t\t\t/>*/}\r\n\r\n\t\t\t\t<button type=\"submit\" >\r\n\t\t\t\t\t\tEnvoyer!\r\n\t\t\t\t</button>\r\n\r\n\t\t\t</form>\r\n\t\t)\r\n\t}\r\n\r\n}\r\n\r\nexport default Form;","import React from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport {\r\n  playSlot,\r\n  jumpTo,\r\n  toggleSort,\r\n  toggleGravity,\r\n  flipBoard,\r\n  endTurn,  \r\n  sendGameSettings,\r\n  watchGame,\r\n  requestGame,\r\n  reset,\r\n  initPlayers,  \r\n  removePlayers,\r\n\r\n  selectTurnAction,\r\n  selectCurrentSign,\r\n  selectPlayers,\r\n  selectTransitions,\r\n  selectGravityState,  \r\n  selectGameSettings,\r\n  selectHistory,\r\n  selectStepNumber,\r\n  selectSortIsAsc,\r\n} from './connectXSlice';\r\nimport Board from './components/Board';\r\nimport Form from './components/Form';\r\nimport { Switch, Reset } from '../general/helpers/Components';\r\nimport { calculateWinner } from '../general/helpers/Functions';\r\n// CSS\r\nimport styles from './ConnectX.module.css';\r\n\r\nexport function ConnectX(props) {\r\n  const dispatch = useDispatch();\r\n\r\n  let history = useSelector(selectHistory);\r\n  const stepNumber = useSelector(selectStepNumber);\r\n\r\n  const currentSlots = history[stepNumber].slots;\r\n  const turnAction = useSelector(selectTurnAction);\r\n  const players = useSelector(selectPlayers);\r\n  const pseudo = props.pseudo;\r\n\r\n  let gameSettingsForm = <Form sendGameSettings={(i) => dispatch(sendGameSettings(i))} />\r\n  let requestGameButton = <button onClick={() => dispatch(requestGame(pseudo))}>Request game</button>\r\n  let endTurnButton = null;\r\n  let resetButton = <Reset title=\"Reset\" onClick={() => dispatch(reset())}/>\r\n\r\n  let gameControls =\r\n    <div>\r\n      <button onClick={() => dispatch(flipBoard(1))}>Flip right</button>\r\n      <button onClick={() => dispatch(flipBoard(-1))}>Flip left</button>\r\n      <Switch isOn={!useSelector(selectGravityState)} onClick={() => dispatch(toggleGravity({toggle:true}))}/>\r\n    </div>;\r\n\r\n  const disabledGameControls =\r\n    <div>\r\n      <button className={styles.disabled} onClick={() => {}}>Flip right</button>\r\n      <button className={styles.disabled} onClick={() => {}}>Flip left</button>\r\n      <Switch className={styles.disabled} isOn={!useSelector(selectGravityState)} onClick={() => {}}/>\r\n    </div>;\r\n\r\n  let playSlotFunc = (i) => dispatch(playSlot(i));\r\n\r\n  const currentSign = useSelector(selectCurrentSign);\r\n  console.log(\"currentSign\",currentSign);\r\n  console.log(\"players\",players);\r\n\r\n  if (players && players.length > 0) {\r\n    const playerCount = players.length;\r\n    console.log(\"playerCount\",playerCount);\r\n\r\n    const myPlayer = players.find(e => e.pseudo === pseudo);\r\n    const isPlayer = myPlayer !== undefined;\r\n    console.log(\"myplayer\",myPlayer);\r\n\r\n    if (isPlayer) {\r\n      const waitingForGame = playerCount === 1;\r\n      const inGame = playerCount === 2;\r\n  \r\n      if (waitingForGame || inGame) {\r\n        console.log(\"waitingForGame\",waitingForGame);\r\n        window.onunload = function(event) {\r\n          dispatch(removePlayers());\r\n        };\r\n        requestGameButton = null;\r\n      }\r\n  \r\n      if (inGame) {\r\n        const mySign = myPlayer.sign;\r\n        const isMyTurn = mySign === currentSign ? true : false;\r\n        console.log(isMyTurn);\r\n        if (!isMyTurn) {\r\n          dispatch(watchGame(mySign));\r\n          playSlotFunc = () => {};\r\n          gameControls = disabledGameControls;\r\n        }\r\n        gameSettingsForm = null;\r\n        resetButton = null;\r\n      }\r\n    } else {\r\n      const gameInProgress = playerCount === 2;\r\n      const opponentWaiting = playerCount === 1;\r\n  \r\n      if (gameInProgress || isPlayer) {\r\n        requestGameButton = null;\r\n      }\r\n    }\r\n  } else if (players && players.length === 0) {\r\n    console.log(\"am i crazy\", players);\r\n    dispatch(initPlayers());\r\n  }\r\n\r\n  // We want the player to use one of his two actions to fill a slot\r\n  if (turnAction.number) {\r\n    const previousAction = turnAction.action;\r\n    if (previousAction === 1) {\r\n      playSlotFunc = () => {};\r\n      endTurnButton = <button onClick={() => dispatch(endTurn())}>End turn</button>\r\n    } else {\r\n      gameControls = disabledGameControls;\r\n    }\r\n  }\r\n\r\n  const gameSettings = useSelector(selectGameSettings);\r\n  const boardFlip = history[stepNumber].boardFlip;\r\n  const boardParams = {\r\n    width: gameSettings.width,\r\n    height: gameSettings.height\r\n  }\r\n\r\n  let transitions = useSelector(selectTransitions);\r\n  let winIndexes = [];\r\n  const scoreTarget = gameSettings.scoreTarget;\r\n  if (stepNumber >= (scoreTarget * 2 - 1)) {\r\n    const boardWidth = boardFlip % 2 === 0 ? boardParams.width : boardParams.height;\r\n    winIndexes = calculateWinner((history[stepNumber - 1]).slots, currentSlots, scoreTarget, boardWidth);\r\n  }\r\n  \r\n  // We create the move list to be displayed from the history\r\n  let moves = history.map((step, move) => {\r\n    const desc = move ?'Move #' + move : 'Game start';\r\n    const isSelected = stepNumber === move ? true : false;\r\n    const isLatestHistoryMove = move === history.length - 1;\r\n\r\n    return (\r\n      <li key={move}>\r\n        <Board\r\n          boardParams={boardParams}        \r\n          isSelected={isSelected}\r\n          slots={history[move].slots}\r\n          transitions={isLatestHistoryMove ? transitions : null}\r\n          flip={history[move].boardFlip}\r\n          onClick={() => dispatch(jumpTo(move))}\r\n          title={desc}\r\n        />\r\n      </li>\r\n    );\r\n  });\r\n\r\n  const sortIsAsc = useSelector(selectSortIsAsc);\r\n  // We sort the resulting array in descending order if the toggle is on\r\n  moves = sortIsAsc ? moves : moves.sort((a, b) => b.key - a.key);\r\n\r\n  // Choose which game status has to be displayed !!!!!!!!!! IMPROVE DISPLAY !!!!!!!!!!!!!!\r\n  let status;\r\n  if (winIndexes.length) {\r\n    let streakCount = 0;\r\n    winIndexes.forEach(index => {\r\n      if(currentSlots[index] === 'X') streakCount++;\r\n    });\r\n    if(streakCount > winIndexes.length - streakCount) {\r\n      status = 'Winner: X';\r\n    } else if (streakCount < winIndexes.length - streakCount){\r\n      status = 'Winner: O';\r\n    } else {\r\n      status = 'Draw!'\r\n    }\r\n  } else if (!winIndexes.length && stepNumber === currentSlots.length) {\r\n    status = 'Draw!'\r\n  } /*else if (turnAction.action === 1) {\r\n    status = 'Next player: ' + player === 'X' ? 'O' : 'X'\r\n  } */else {\r\n    status = 'Next player: ' + currentSign\r\n  }\r\n  return (\r\n    <div className={styles.game}>\r\n      {gameSettingsForm}\r\n      <Board\r\n        isMainBoard={true}\r\n        boardParams={boardParams}\r\n        slots={currentSlots}\r\n        transitions={transitions}\r\n        flip={boardFlip}\r\n        winIndexes={winIndexes}\r\n        onClick={(i) => playSlotFunc(i)}\r\n      />\r\n      <div className={styles.game_info}>\r\n        <div className={styles.status}>{status}</div>\r\n        <div className={styles.controls}>\r\n          {requestGameButton}\r\n          {gameControls}\r\n          <Switch isOn={!sortIsAsc} onClick={() => dispatch(toggleSort())}/>\r\n          {endTurnButton}\r\n          {resetButton}\r\n        </div>\r\n      {/*Restructure the scroll box so it expands as the moves come in, but make it scrollable so it slides under the main div\r\n         Basically remove the scroll bar entirely, make the bottom of the page a div that translateY onScrollEvent*/}\r\n        <div className={styles.scrollableY}>\r\n          <ol className={styles.moves}>{moves}</ol>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","// A function that returns an array of indexes corresponding the slots that are part of a winning streak\r\n// on a two dimensionnal board, whatever the (reasonable) size\r\n// (previous) and (current) are arrays representing the two dimensionnal board at different steps\r\n// (scoreTarget) is the INT number of slots of the same value in line needed to win\r\n// (rowLength) is the INT number of slots in a single row of the board\r\nexport function calculateWinner(previous, current, scoreTarget, rowLength) {\r\n  let winSlots = [];\r\n  let finalWinSlots = [];\r\n\r\n  // We look for the differences between the current and previous board\r\n  let indexes = [];\r\n  for(const i in current) {\r\n    if(current[i] !== previous[i]) indexes.push(parseInt(i));\r\n  }\r\n\r\n  // console.log(indexes);\r\n  // We loop through each of these slots, as potential part of a winning streak\r\n  for (let j = indexes.length - 1; j >= 0; j--) {\r\n    const index = indexes[j];\r\n    // We dont run the check if the current index is already marked as part of a streak\r\n    if(!finalWinSlots.includes(index)) {\r\n      const currentValue = current[index];\r\n      // We search for streaks of the same value on all 4 axes and 8 directions, starting from the current index\r\n      // Horizontal axis\r\n      let streakL = 0;\r\n      for(let i = index; i > index - scoreTarget; i--) {\r\n        if(current[i-1] && current[i-1] === currentValue && i % rowLength !== 0) {\r\n          streakL++;\r\n          winSlots.push(i-1);\r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n      let streakR = 0;\r\n      for(let i = index; i < index + scoreTarget; i++) {\r\n        if(current[i+1] && current[i+1] === currentValue && (i+1) % rowLength !== 0) {\r\n          streakR++;\r\n          winSlots.push(i+1);\r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n      // We add the streak of both direction together, and check if it reaches the required score\r\n      const isWinHoriz = (streakL + streakR) >= scoreTarget - 1 ? true : false;\r\n      // console.log(streakL);\r\n      // console.log(streakR);\r\n      // console.log(\"WIN HORIZ:\", isWinHoriz);\r\n      \r\n      // If it does, we add the current index to our work variable as part of the streak,\r\n      // then add the whole thing to our return variable\r\n      if(isWinHoriz) {\r\n        winSlots.push(index);   \r\n        finalWinSlots = finalWinSlots.concat(winSlots);\r\n      }     \r\n      winSlots = [];\r\n\r\n      // Vertical axis\r\n      let streakT = 0;\r\n      for(let i = index; i > index - (scoreTarget * rowLength); i -= rowLength) {\r\n        if(current[i-rowLength] && current[i-rowLength] === currentValue) {\r\n          streakT++;\r\n          winSlots.push(i-rowLength);      \r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n      let streakB = 0;\r\n      for(let i = index; i < index + (scoreTarget * rowLength); i += rowLength) {\r\n        if(current[i+rowLength] && current[i+rowLength] === currentValue) {\r\n          streakB++;\r\n          winSlots.push(i+rowLength);      \r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n      const isWinVert = (streakT + streakB) >= scoreTarget - 1 ? true : false;\r\n      // console.log(streakT);\r\n      // console.log(streakB);\r\n      // console.log(\"WIN VERT:\", isWinVert);\r\n\r\n      if(isWinVert) {\r\n        winSlots.push(index);\r\n        finalWinSlots = finalWinSlots.concat(winSlots);\r\n      }\r\n      winSlots = [];\r\n\r\n      // Top diagonal axis\r\n      let streakTL = 0;\r\n      for(let i = index; i > index - scoreTarget * (rowLength + 1); i -= (rowLength + 1)) {\r\n        if(current[i-rowLength-1] && current[i-rowLength-1] === currentValue && i % rowLength !== 0) {\r\n          streakTL++;\r\n          winSlots.push(i-rowLength-1);      \r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n      let streakBR = 0;\r\n      for(let i = index; i < index + scoreTarget * (rowLength + 1); i += (rowLength + 1)) {\r\n        if(current[i+rowLength+1] && current[i+rowLength+1] === currentValue && (i+1) % rowLength !== 0) {\r\n          streakBR++;\r\n          winSlots.push(i+rowLength+1);      \r\n        } else {\r\n          break;\r\n        }\r\n      }  \r\n      const isWinDiagT = (streakTL + streakBR) >= scoreTarget - 1 ? true : false;\r\n      // console.log(streakTL);\r\n      // console.log(streakBR);\r\n      // console.log(\"WIN DIAGT:\", isWinDiagT);\r\n\r\n      if(isWinDiagT) {\r\n        winSlots.push(index);\r\n        finalWinSlots = finalWinSlots.concat(winSlots);\r\n      }\r\n      winSlots = [];\r\n\r\n      // Bottom diagonal axis\r\n      let streakTR = 0;\r\n      for(let i = index; i > index - scoreTarget * (rowLength - 1); i -= (rowLength - 1)) {\r\n        if(current[i-rowLength+1] && current[i-rowLength+1] === currentValue && (i+1) % rowLength !== 0) {\r\n          streakTR++;\r\n          winSlots.push(i-rowLength+1);      \r\n        } else {\r\n          break;\r\n        }\r\n      }  \r\n      let streakBL = 0;\r\n      for(let i = index; i < index + scoreTarget * (rowLength - 1); i += (rowLength - 1)) {\r\n        if(current[i+rowLength-1] && current[i+rowLength-1] === currentValue && i % rowLength !== 0) {\r\n          streakBL++;\r\n          winSlots.push(i+rowLength-1);      \r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n      const isWinDiagB = (streakTR + streakBL) >= scoreTarget - 1 ? true : false;\r\n      // console.log(streakTR);\r\n      // console.log(streakBL);\r\n      // console.log(\"WIN DIAGB:\", isWinDiagB);\r\n\r\n      if(isWinDiagB) {\r\n        winSlots.push(index);\r\n        finalWinSlots = finalWinSlots.concat(winSlots);\r\n      }\r\n      winSlots = [];\r\n    }\r\n  } \r\n\r\n  // console.log(finalWinSlots);  \r\n  return finalWinSlots;\r\n}\r\n\r\n////////////////////////////////////////////////////////////////////////////////////////////////////","// A mock function to mimic making an async request for data\r\nexport function fetchCount(amount = 1) {\r\n  return new Promise((resolve) =>\r\n    setTimeout(() => resolve({ data: amount }), 500)\r\n  );\r\n}\r\n","import { createAsyncThunk, createSlice } from '@reduxjs/toolkit';\r\nimport { fetchCount } from './counterAPI';\r\n\r\nconst initialState = {\r\n  value: 0,\r\n  status: 'idle',\r\n};\r\n\r\n// The function below is called a thunk and allows us to perform async logic. It\r\n// can be dispatched like a regular action: `dispatch(incrementAsync(10))`. This\r\n// will call the thunk with the `dispatch` function as the first argument. Async\r\n// code can then be executed and other actions can be dispatched. Thunks are\r\n// typically used to make async requests.\r\nexport const incrementAsync = createAsyncThunk(\r\n  'counter/fetchCount',\r\n  async (amount) => {\r\n    const response = await fetchCount(amount);\r\n    // The value we return becomes the `fulfilled` action payload\r\n    return response.data;\r\n  }\r\n);\r\n\r\nexport const counterSlice = createSlice({\r\n  name: 'counter',\r\n  initialState,\r\n  // The `reducers` field lets us define reducers and generate associated actions\r\n  reducers: {\r\n    increment: (state) => {\r\n      // Redux Toolkit allows us to write \"mutating\" logic in reducers. It\r\n      // doesn't actually mutate the state because it uses the Immer library,\r\n      // which detects changes to a \"draft state\" and produces a brand new\r\n      // immutable state based off those changes\r\n      state.value += 1;\r\n    },\r\n    decrement: (state) => {\r\n      state.value -= 1;\r\n    },\r\n    // Use the PayloadAction type to declare the contents of `action.payload`\r\n    incrementByAmount: (state, action) => {\r\n      state.value += action.payload;\r\n    },\r\n  },\r\n  // The `extraReducers` field lets the slice handle actions defined elsewhere,\r\n  // including actions generated by createAsyncThunk or in other slices.\r\n  extraReducers: (builder) => {\r\n    builder\r\n      .addCase(incrementAsync.pending, (state) => {\r\n        state.status = 'loading';\r\n      })\r\n      .addCase(incrementAsync.fulfilled, (state, action) => {\r\n        state.status = 'idle';\r\n        state.value += action.payload;\r\n      });\r\n  },\r\n});\r\n\r\nexport const { increment, decrement, incrementByAmount } = counterSlice.actions;\r\n\r\n// The function below is called a selector and allows us to select a value from\r\n// the state. Selectors can also be defined inline where they're used instead of\r\n// in the slice file. For example: `useSelector((state: RootState) => state.counter.value)`\r\nexport const selectCount = (state) => state.counter.value;\r\n\r\n// We can also write thunks by hand, which may contain both sync and async logic.\r\n// Here's an example of conditionally dispatching actions based on current state.\r\nexport const incrementIfOdd = (amount) => (dispatch, getState) => {\r\n  const currentValue = selectCount(getState());\r\n  if (currentValue % 2 === 1) {\r\n    dispatch(incrementByAmount(amount));\r\n  }\r\n};\r\n\r\nexport default counterSlice.reducer;\r\n","import React, { useState } from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport {\r\n  decrement,\r\n  increment,\r\n  incrementByAmount,\r\n  incrementAsync,\r\n  incrementIfOdd,\r\n  selectCount,\r\n} from './counterSlice';\r\nimport styles from './Counter.module.css';\r\n\r\nexport function Tbd() {\r\n  const count = useSelector(selectCount);\r\n  const dispatch = useDispatch();\r\n  const [incrementAmount, setIncrementAmount] = useState('2');\r\n\r\n  const incrementValue = Number(incrementAmount) || 0;\r\n\r\n  return (\r\n    <div>\r\n      <div className={styles.row}>\r\n        <button\r\n          className={styles.button}\r\n          aria-label=\"Decrement value\"\r\n          onClick={() => dispatch(decrement())}\r\n        >\r\n          -\r\n        </button>\r\n        <span className={styles.value}>{count}</span>\r\n        <button\r\n          className={styles.button}\r\n          aria-label=\"Increment value\"\r\n          onClick={() => dispatch(increment())}\r\n        >\r\n          +\r\n        </button>\r\n      </div>\r\n      <div className={styles.row}>\r\n        <input\r\n          className={styles.textbox}\r\n          aria-label=\"Set increment amount\"\r\n          value={incrementAmount}\r\n          onChange={(e) => setIncrementAmount(e.target.value)}\r\n        />\r\n        <button\r\n          className={styles.button}\r\n          onClick={() => dispatch(incrementByAmount(incrementValue))}\r\n        >\r\n          Add Amount\r\n        </button>\r\n        <button\r\n          className={styles.asyncButton}\r\n          onClick={() => dispatch(incrementAsync(incrementValue))}\r\n        >\r\n          Add Async\r\n        </button>\r\n        <button\r\n          className={styles.button}\r\n          onClick={() => dispatch(incrementIfOdd(incrementValue))}\r\n        >\r\n          Add If Odd Tbd\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React, { Component } from 'react';\r\n// import logo from './logo.svg';\r\nimport { Nav } from './features/nav/Nav';\r\nimport { Counter } from './features/counter/Counter';\r\nimport { TicTacToe } from './features/tictactoe/TicTacToe';\r\nimport { ConnectX } from './features/connectX/ConnectX';\r\nimport { Tbd } from './features/bejeweled/Tbd';\r\nimport { loadState } from './localStorage';\r\nimport history from './history';\r\n// CSS\r\nimport './App.css';\r\n\r\nclass App extends Component {\r\n  constructor() {\r\n    super();\r\n    this.state = {\r\n      items: {\r\n        'Counter': Counter,\r\n        'TicTacToe': TicTacToe,\r\n        'ConnectX': ConnectX,\r\n        'Tbd': Tbd\r\n      },\r\n      itemSelected: null,\r\n      userPseudo: \"\",    \r\n    };\r\n    this.handleClick = this.handleClick.bind(this);    \r\n  }\r\n\r\n  componentDidMount() {\r\n    let pseudo = this.state.userPseudo; \r\n    console.log(\"componentDidMount\",pseudo);\r\n    if (!pseudo) {\r\n      pseudo = loadState();\r\n      console.log(\"pseudo after loadState\", pseudo);\r\n      if (!pseudo) pseudo = \"\";\r\n      this.setState({ userPseudo: pseudo});\r\n      if (!pseudo) {\r\n        history.push(`/redux-project/login`);\r\n      }\r\n    }\r\n\r\n    const vh = window.innerHeight * 0.01;\r\n    document.documentElement.style.setProperty('--vh', `${vh}px`);    \r\n  }\r\n\r\n  handleClick(i) {\r\n    this.setState({ itemSelected: i.target.name});\r\n  }\r\n\r\n  render() {\r\n    const pseudo = this.state.userPseudo; \r\n    console.log(\"render\",pseudo);\r\n    const itemSelected = this.state.itemSelected ? React.createElement(this.state.items[this.state.itemSelected], {pseudo: pseudo}) : null;    \r\n    return (\r\n      <div className=\"App\">\r\n        <Nav items={this.state.items} handleClick={this.handleClick}/>\r\n        <div className=\"main\">{itemSelected}</div>\r\n{/*        <footer>\r\n          <span>\r\n            <span>Learn </span>\r\n            <a\r\n              className=\"App-link\"\r\n              href=\"https://reactjs.org/\"\r\n              target=\"_blank\"\r\n              rel=\"noopener noreferrer\"\r\n            >\r\n              React\r\n            </a>\r\n            <span>, </span>\r\n            <a\r\n              className=\"App-link\"\r\n              href=\"https://redux.js.org/\"\r\n              target=\"_blank\"\r\n              rel=\"noopener noreferrer\"\r\n            >\r\n              Redux\r\n            </a>\r\n            <span>, </span>\r\n            <a\r\n              className=\"App-link\"\r\n              href=\"https://redux-toolkit.js.org/\"\r\n              target=\"_blank\"\r\n              rel=\"noopener noreferrer\"\r\n            >\r\n              Redux Toolkit\r\n            </a>\r\n            ,<span> and </span>\r\n            <a\r\n              className=\"App-link\"\r\n              href=\"https://react-redux.js.org/\"\r\n              target=\"_blank\"\r\n              rel=\"noopener noreferrer\"\r\n            >\r\n              React Redux\r\n            </a>\r\n          </span>        \r\n        </footer>*/}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default App;","import React from 'react';\r\n\r\nconst NotFound = () => {\r\n\treturn (\r\n\t\t<h2 className=\"notFound\">Nothing to see here</h2>\r\n\t)\r\n}\r\n\r\nexport default NotFound;","import {\r\n\tconfigureStore,\r\n\tcombineReducers,\r\n\tgetDefaultMiddleware\r\n} from '@reduxjs/toolkit';\r\n\r\nimport navReducer from '../features/nav/navSlice';\r\nimport counterReducer from '../features/counter/counterSlice';\r\nimport tictactoeReducer from '../features/tictactoe/tictactoeSlice';\r\nimport connectXReducer from '../features/connectX/connectXSlice';\r\n\r\nconst combinedReducer = combineReducers({\r\n  nav: navReducer,\r\n  counter: counterReducer,\r\n  tictactoe: tictactoeReducer,\r\n  connectX: connectXReducer,\r\n});\r\n\r\nconst rootReducer = (state, action) => {\r\n// Reducers are supposed to return the initial state when they are called\r\n// with undefined as the first argument, no matter the action\r\n  if (action.type === 'nav/reset') {\r\n    state = undefined;\r\n  }\r\n  return combinedReducer(state, action);\r\n};\r\n\r\nconst customizedMiddleware = getDefaultMiddleware({\r\n  serializableCheck: false\r\n});\r\n\r\nexport default configureStore({\r\n  reducer: rootReducer,\r\n  middleware: [...customizedMiddleware]\r\n});\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\n// Rooter\r\nimport {Router, Route, Switch} from 'react-router-dom';\r\nimport history from './history';\r\n\r\n//Components\r\nimport Connexion from './components/Connexion'\r\nimport App from './App';\r\nimport NotFound from './components/NotFound'\r\n\r\nimport store from './app/store';\r\nimport { Provider } from 'react-redux';\r\n// import * as serviceWorker from './serviceWorker';\r\n\r\nconst baseURL = \"/redux-project\";\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <Provider store={store}>\r\n\t\t\t<Router history={history}>\r\n\t\t\t\t<Switch>\r\n\t\t\t\t\t<Route exact path={`${baseURL}/login`} component={Connexion} />\r\n\t\t\t\t\t<Route path={`${baseURL}`} component={App} /> \r\n\t\t\t\t\t<Route path={`${baseURL}/`} component={NotFound}/>\r\n\t\t\t\t</Switch>\r\n\t\t\t</Router>\r\n    </Provider>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\n// serviceWorker.unregister();\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"game\":\"ConnectX_game__1x_fZ\",\"form\":\"ConnectX_form__34LiB\",\"main\":\"ConnectX_main__6vhcL\",\"main_board\":\"ConnectX_main_board__1BL24\",\"title\":\"ConnectX_title__2bStg\",\"board\":\"ConnectX_board__3OnTo\",\"board_row\":\"ConnectX_board_row__CsIJA\",\"slot\":\"ConnectX_slot__25hJA\",\"slotContent\":\"ConnectX_slotContent__GfqZP\",\"slotContentX\":\"ConnectX_slotContentX__18XTw\",\"slotContentO\":\"ConnectX_slotContentO__1evBh\",\"win\":\"ConnectX_win__X-N9o\",\"scaleAnim\":\"ConnectX_scaleAnim__3zEhe\",\"game_info\":\"ConnectX_game_info__2JF9V\",\"controls\":\"ConnectX_controls__ekhdW\",\"status\":\"ConnectX_status__2MWFR\",\"moves\":\"ConnectX_moves__1ki_t\",\"selected\":\"ConnectX_selected__1Puyt\",\"kbd-navigation\":\"ConnectX_kbd-navigation__35g11\",\"scrollableY\":\"ConnectX_scrollableY__1Mm7t\",\"flipR\":\"ConnectX_flipR__2HwCv\",\"animate\":\"ConnectX_animate__3ZyN7\",\"flip\":\"ConnectX_flip__2PQK3\",\"fall\":\"ConnectX_fall__13rRa\"};"],"sourceRoot":""}